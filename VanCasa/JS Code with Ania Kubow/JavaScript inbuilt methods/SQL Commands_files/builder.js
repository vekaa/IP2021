!function(e,t,a,i,r){"use strict";e.codeEditor=function(e,n){var o,d,s,u,c,l,p,g,h=i(e),m=h.children("textarea")[0],f=i(m);if(m&&m.id&&(o=m.id,d=t.create(o,{delayLoading:!0,setValue:function(e){h.codeEditor("setValue",e)},getValue:function(){return h.codeEditor("getValue")},setFocusTo:function(){return h.codeEditor("focus"),{focus:function(){}}}})),n.language)g=n.language;else{if(!n.modeBasedOnItem)throw new Error("Either a language mode or a Page Item which holds the language must be provided");{function x(e){var t=e.toLowerCase();return t.indexOf("sql")>-1?"sql":"javascript"===t?"mle-javascript":t()}g=x($v(n.modeBasedOnItem)),i("#"+r.escapeCSS(n.modeBasedOnItem)).on("change",(function(){h.codeEditor("option","language",x($v(n.modeBasedOnItem)))}))}}h.height(f.height()+80),f.hide(),n.validate&&!n.readOnly&&(s=function(e,t){a.plugin(n.ajaxIdentifier,{x01:"validate",x02:n.appId,x09:""===n.itemRemoteDB?null:$v(n.itemRemoteDB),x10:n.modeBasedOnItem?$v(n.modeBasedOnItem):null,p_clob_01:e},{success:function(e){"OK"===e.result?t({errors:[]}):t({errors:[e.result]})}})}),n.queryBuilder&&(u=function(e,t){n.itemRemoteDB&&""!==n.itemRemoteDB?apex.message.alert(apex.lang.formatMessage("WWV_FLOW_BUILDER.REMOTESQL.QUERY_BUILDER_NOT_SUPPORTED")):apex.navigation.popup({url:apex.util.makeApplicationUrl({appId:4500,pageId:1002,clearCache:1002,itemNames:["P1002_RETURN_INTO","P1002_POPUP","P1002_SCHEMA"],itemValues:[e.baseId,"1",n.parsingSchema]}),width:950,height:720})}),c=function(e,t){""===$v(n.itemRemoteDB)?a.plugin(n.ajaxIdentifier,{p_widget_name:e.type,x01:"hint",x02:n.appId,x03:e.search,x04:e.parent,x05:e.grantParent},{success:t}):console.log(apex.lang.formatMessage("WWV_FLOW_BUILDER.REMOTESQL.CODE_COMPLETION_NOT_SUPPORTED"))},l=function(){var e=i(this).codeEditor("getPreferencesString");a.plugin(n.ajaxIdentifier,{x01:"save",x02:n.appId,x03:e},{queue:{name:"codeEditor_save_settings",action:"lazyWrite"},dataType:""})},p=function(){o&&d.resolve()},h.codeEditor(i.extend({language:g,value:m?i(m).val():"",readOnly:n.readOnly,ariaLabel:n.ariaLabel,codeComplete:c,validateCode:s,queryBuilder:(!n.itemRemoteDB||""===n.itemRemoteDB)&&u,preferencesChanged:l,onInitialized:p},i.apex.codeEditor.preferencesObjectFromString(n.settings||""))),n.adjustableHeight&&(h.wrap("<div class='a-CodeEditor--resizeWrapper'></div>").parent().resizable({handles:"s",helper:"a-CodeEditor--resizeHelper",minHeight:100,maxHeight:1e3}).on("resizestop",(function(e,t){var a=i(this),r=i(this).children().eq(0);r.height(a.height()),r.trigger("resize")})),h.parent().find(".ui-resizable-handle.ui-resizable-s").attr("tabindex",0).on("keydown",(function(e){if(e.which===i.ui.keyCode.UP||e.which===i.ui.keyCode.DOWN){var t,a=i(this).parent();t=e.which===i.ui.keyCode.UP?a.height()-10:a.height()+10,t=Math.max(t,100),t=Math.min(t,1e3),a.height(t).trigger("resizestop"),e.preventDefault()}}))),apex.widget.util.onVisibilityChange(i("#"+r.escapeCSS(o)+"_CONTAINER")[0],(function(e){e&&h.trigger("resize")}))},e.codeEditor.saveProcess=function(e,t,r,n){var o,d=n?i.extend(!0,{},n):{};if((o=i(e).codeEditor("getValue")).length<=4e3)d[r]=o;else{for(d[r]=[];o.length>4e3;)d[r].push(o.substr(0,4e3)),o=o.substr(4e3);d[r].push(o.substr(0,4e3))}return a.process(t,d,{dataType:"",loadingIndicator:e,loadingIndicatorPosition:"page"})},e.codeEditor.saveSubmit=function(e,t,a){var n,o=a.form||"wwv_flow",d=i("form[name='"+r.escapeHTMLAttr(o)+"']",apex.gPageContext$);function s(e){d.append("<input type='hidden' name='"+r.escapeHTMLAttr(t)+"' value = '"+apex.util.escapeHTML(e)+"'>")}if((n=i(e).codeEditor("getValue")).length<=4e3)s(n);else{for(;n.length>4e3;)s(n.substr(0,4e3)),n=n.substr(4e3);s(n.substr(0,4e3))}apex.page.submit(a)},i((function(){i(document.body).on("codeeditorpreferenceschanged",(function(e){var t=i(e.target),a=i.apex.codeEditor.preferencesObjectFromString(t.codeEditor("getPreferencesString"));i(".a-MonacoEditor").each((function(){this!==e.target&&i(this).codeEditor("option",a)}))}))}))}(apex.builder.plugin,apex.item,apex.server,apex.jQuery,apex.util);